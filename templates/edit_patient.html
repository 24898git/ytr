{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h4 class="card-title mb-0">
                    <i class="fas fa-edit me-2"></i>Edit Patient: {{ patient['name'] }}
                </h4>
            </div>
            <div class="card-body">
                <form method="POST" id="patientForm">
                    <div class="row">
                        <!-- Patient ID Display -->
                        <div class="col-12 mb-4">
                            <div class="alert alert-primary">
                                <strong>Patient ID:</strong> {{ patient['patient_id'] }}
                                <br><small class="text-muted">This ID cannot be changed</small>
                            </div>
                        </div>
                        
                        <!-- Personal Information -->
                        <div class="col-md-6">
                            <h5 class="border-bottom pb-2 mb-3 text-primary">
                                <i class="fas fa-user me-2"></i>Personal Information
                            </h5>
                            
                            <div class="mb-3">
                                <label for="name" class="form-label">Full Name *</label>
                                <input type="text" class="form-control" id="name" name="name" 
                                       value="{{ patient['name'] }}" required>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="age" class="form-label">Age *</label>
                                    <input type="number" class="form-control" id="age" name="age" 
                                           value="{{ patient['age'] }}" required min="0" max="150">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="gender" class="form-label">Gender *</label>
                                    <select class="form-select" id="gender" name="gender" required>
                                        <option value="Male" {% if patient['gender'] == 'Male' %}selected{% endif %}>Male</option>
                                        <option value="Female" {% if patient['gender'] == 'Female' %}selected{% endif %}>Female</option>
                                        <option value="Other" {% if patient['gender'] == 'Other' %}selected{% endif %}>Other</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="blood_type" class="form-label">Blood Type</label>
                                    <select class="form-select" id="blood_type" name="blood_type">
                                        <option value="">Select Blood Type</option>
                                        <option value="A+" {% if patient['blood_type'] == 'A+' %}selected{% endif %}>A+</option>
                                        <option value="A-" {% if patient['blood_type'] == 'A-' %}selected{% endif %}>A-</option>
                                        <option value="B+" {% if patient['blood_type'] == 'B+' %}selected{% endif %}>B+</option>
                                        <option value="B-" {% if patient['blood_type'] == 'B-' %}selected{% endif %}>B-</option>
                                        <option value="AB+" {% if patient['blood_type'] == 'AB+' %}selected{% endif %}>AB+</option>
                                        <option value="AB-" {% if patient['blood_type'] == 'AB-' %}selected{% endif %}>AB-</option>
                                        <option value="O+" {% if patient['blood_type'] == 'O+' %}selected{% endif %}>O+</option>
                                        <option value="O-" {% if patient['blood_type'] == 'O-' %}selected{% endif %}>O-</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="last_visit" class="form-label">Last Visit Date</label>
                                    <input type="date" class="form-control" id="last_visit" name="last_visit" 
                                           value="{{ patient['last_visit'] if patient['last_visit'] }}">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contact Information -->
                        <div class="col-md-6">
                            <h5 class="border-bottom pb-2 mb-3 text-primary">
                                <i class="fas fa-address-card me-2"></i>Contact Information
                            </h5>
                            
                            <div class="mb-3">
                                <label for="contact" class="form-label">Contact Number</label>
                                <input type="tel" class="form-control" id="contact" name="contact"
                                       value="{{ patient['contact'] if patient['contact'] }}"
                                       placeholder="Phone number">
                            </div>
                            
                            <div class="mb-3">
                                <label for="email" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="email" name="email"
                                       value="{{ patient['email'] if patient['email'] }}"
                                       placeholder="email@example.com">
                            </div>
                            
                            <div class="mb-3">
                                <label for="emergency_contact" class="form-label">Emergency Contact</label>
                                <input type="text" class="form-control" id="emergency_contact" name="emergency_contact"
                                       value="{{ patient['emergency_contact'] if patient['emergency_contact'] }}"
                                       placeholder="Emergency contact person and number">
                            </div>
                            
                            <div class="mb-3">
                                <label for="address" class="form-label">Address</label>
                                <textarea class="form-control" id="address" name="address" rows="3"
                                          placeholder="Full address">{{ patient['address'] if patient['address'] }}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Medical Information -->
                    <div class="row mt-3">
                        <div class="col-12">
                            <h5 class="border-bottom pb-2 mb-3 text-primary">
                                <i class="fas fa-file-medical me-2"></i>Medical Information
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="medical_history" class="form-label">Medical History</label>
                                    <textarea class="form-control" id="medical_history" name="medical_history" rows="4"
                                              placeholder="Previous medical conditions, surgeries, chronic diseases...">{{ patient['medical_history'] if patient['medical_history'] }}</textarea>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="allergies" class="form-label">Allergies</label>
                                        <textarea class="form-control" id="allergies" name="allergies" rows="2"
                                                  placeholder="Known allergies...">{{ patient['allergies'] if patient['allergies'] }}</textarea>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="medications" class="form-label">Current Medications</label>
                                        <textarea class="form-control" id="medications" name="medications" rows="2"
                                                  placeholder="Current medications and dosages...">{{ patient['medications'] if patient['medications'] }}</textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Form Actions -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <a href="{{ url_for('index') }}" class="btn btn-secondary me-md-2">
                                    <i class="fas fa-times me-1"></i>Cancel
                                </a>
                                <button type="submit" class="btn btn-warning">
                                    <i class="fas fa-save me-1"></i>Update Patient
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('patientForm');
    
    form.addEventListener('submit', function(event) {
        const name = document.getElementById('name').value.trim();
        const age = document.getElementById('age').value.trim();
        const gender = document.getElementById('gender').value;
        
        if (!name || !age || !gender) {
            event.preventDefault();
            alert('Please fill in all required fields (Name, Age, Gender).');
            return false;
        }
        
        return true;
    });
});
</script>
{% endblock %}